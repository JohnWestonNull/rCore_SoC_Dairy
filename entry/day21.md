# 7月17日，Day 21

## Lab 5 阅读

为了避免一些奇怪的问题，我准备在 Lab 前先阅读下文档，了解下具体结构。

#### 设备树

在 OpenSBI 启动时，它会扫描一遍物理设备的各种外设，并且将其以设备树的形式存储在内存的某个位置。

（PS：教程说会将其保存在 `0x8220_0000` 附近，如果这样的话，我们的 `FrameTracker` 若分配了这块区域会怎么样？）

##### 设备节点

- compatible：设备的编程模型，一般格式为 “manufacturer, model”，例如 “virtio, mmio”
- model：设备型号
- reg：额外信息段

设备树被提出最初是为了解决 ARM 上没有 BIOS 的情况而被加入 Linux 内核之中，用一套树形结构统一描述各个硬件的不同之处。

这块由于涉及硬件较多，因此包含较多的 magic number 等。

#### Virtio

Virtio 是一套半虚拟化技术，由虚拟机和操作系统联合完成虚拟化，但这样操作系统就知道自己被虚拟化了，因此不能直接在硬件上执行，感觉需要更多的了解。

##### mmio 技术

内存映射读写，这块和单片机操作寄存器类似的，相当于操作系统向特定的内存区域写入数据变成操作硬件。对 OS 来说与操作内存没有区别，但是会对外设造成影响。

其实这一章和单片机上很多外设的操作差不多啊.jpg

#### DMA 技术

不经过 CPU， 直接由硬件完成信息传输，在传输结束后触发中断通知处理器处理。



有了这些基础知识应该够用了，但是我还是对设备树的内存地址问题很困惑，去开个 issue 问问。